#!/bin/bash

# Run this script in sudo su -

# Root permission
if [ $USER != 'root' -o $UID != 0 ]; then
    echo 'This script must be run as root (sudo su -).'
    exit 1
fi

# Get current dir (this script can be run from anywhere)
DOTFILES_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

#
# System packages
#

# PPA
add-apt-repository -y ppa:git-core/ppa
add-apt-repository -y ppa:videolan/stable-daily
add-apt-repository -y ppa:nginx/stable
add-apt-repository -y ppa:webupd8team/atom
add-apt-repository ppa:ubuntu-elisp/ppa
add-apt-repository ppa:chris-lea/redis-server
curl -sL https://deb.nodesource.com/setup_8.x | sudo bash -

# Laptop only
if [ -d '/sys/class/power_supply' ]; then
    add-apt-repository -y ppa:linrunner/tlp
fi

# Update package list and upgrade system
apt-get -y update && apt-get -y upgrade

# Redis dependency
SYSTEM_PACKAGES=$SYSTEM_PACKAGES' software-properties-common'
SYSTEM_PACKAGES=$SYSTEM_PACKAGES' curl emacs25 atom git nginx nodejs tmux'
SYSTEM_PACKAGES=$SYSTEM_PACKAGES' redshift htop iftop'
SYSTEM_PACKAGES=$SYSTEM_PACKAGES' skype vlc calibre'

# Laptop only
if [ -d '/sys/class/power_supply' ]; then
    SYSTEM_PACKAGES=$SYSTEM_PACKAGES' powertop tlp'
fi

# Packages installation
apt-get -y install $SYSTEM_PACKAGES

# Remove useless packages
apt-get remove -y --purge growisofs totem totem-common libtotem0 gimp-data mintnanny thunderbird pidgin cowsay mintwelcome hexchat

#
# Terminal configuration
#

# http://www.growingwiththeweb.com/2015/05/colours-in-gnome-terminal.html
# https://github.com/atom-material/atom-material-syntax/blob/master/styles/colors.less
# very-light-gray: #EEFFFF rgb(238,255,255) text color
# light-gray:      #B2CCD6 rgb(178,204,214)
# gray:            #373b41 rgb(55,59,65)
# dark-gray:       #282a2e rgb(40,42,46)
# very-dark-gray:  #263238 rgb(38,50,56) background color
# teal:            #009688 rgb(0,150,136)
# light-teal:      #73d1c8 rgb(115,209,200)
# green:           #C3E88D rgb(195,232,141)
# cyan:            #89DDF3 rgb(137,221,243)
# blue:            #82AAFF rgb(130,170,255)
# indigo:          #7986CB rgb(121,134,203)
# purple:          #C792EA rgb(199,146,234)
# pink:            #FF5370 rgb(255,83,112)
# red:             #F07178 rgb(240,113,120)
# strong-orange:   #F78C6A rgb(247,140,106)
# orange:          #FFCB6B rgb(255,203,107)
# light-orange:    #FFE082 rgb(255,224,130)

profile_id=b1dcc9dd-5262-4d8d-a863-c897e6d979b9
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/bold-color-same-as-fg "true"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/use-theme-colors "false"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/background-transparency-percent "0"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/use-transparent-background "false"
# Left to right colors: black, red, green, orange, blue, purple, cyan/teal, grey
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/palette "['rgb(38,50,56)', 'rgb(240,113,120)', 'rgb(195,232,141)', 'rgb(255,224,130)', 'rgb(130,170,255)', 'rgb(199,146,234)', 'rgb(137,221,243)', 'rgb(178,204,214)', 'rgb(178,204,214)', 'rgb(240,113,120)', 'rgb(195,232,141)', 'rgb(255,224,130)', 'rgb(130,170,255)', 'rgb(199,146,234)', 'rgb(137,221,243)', 'rgb(178,204,214)']"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/background-color "'#263238'"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/visible-name "'Default'"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/bold-color "'#000000'"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/foreground-color "'#FFFFFF'"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/background-color "'#263238'"
dconf write /org/gnome/terminal/legacy/profiles:/:$profile_id/use-theme-transparency "false"

#
# Atom packages
#

apm install --packages-file ../atom/package-list.txt

#
# Symlinks
#

# Emacs
ln -sfv "${DOTFILES_DIR}/emacs/.emacs" "${HOME}/.emacs"
# Bash
ln -sfv "${DOTFILES_DIR}/bash/.bash_aliases" "${HOME}/.bash_aliases"
ln -sfv "${DOTFILES_DIR}/bash/.bash_prompt" "${HOME}/.bash_prompt"
# Redshift
ln -sfv "${DOTFILES_DIR}/redshift/redshift.conf" "${HOME}/redshift/redshift.conf"
# Tmux
ln -sfv "${DOTFILES_DIR}/tmux/.tmux.conf" "${HOME}/.tmux.conf"
# Ruby
ln -sfv "${DOTFILES_DIR}/gemrc/.gemrc" "${HOME}/.gemrc"
# Bundler
ln -sfv "${DOTFILES_DIR}/bundler/config" "${HOME}/.bundle/config"
# GIT
ln -sfv "${DOTFILES_DIR}/git/.gitconfig" "${HOME}/.gitconfig"
# Atom
ln -sfv "${DOTFILES_DIR}/atom/config.cson" "${HOME}/.atom/config.cson"
ln -sfv "${DOTFILES_DIR}/atom/keymap.cson" "${HOME}/.atom/keymap.cson"
ln -sfv "${DOTFILES_DIR}/atom/styles.less" "${HOME}/.atom/styles.less"

source "${HOME}/.bash_prompt"
